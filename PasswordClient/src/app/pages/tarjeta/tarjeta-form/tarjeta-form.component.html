<section class="section-main">

  <app-header 
    [titulo]="tarjeta ? 'Editar Tarjeta' : 'Nueva Tarjeta'" 
    [showSearch]="false"
    [showButton]="false"
  ></app-header>

  <!-- Main -->
  <main class="form-container">
    <!-- Form -->
    <form *ngIf="!loading; else loadingTemplate" [formGroup]="form" (ngSubmit)="save()">

      <!-- Numeración -->
      <div class="mb-3">
        <label class="form-label">Numeración</label>
        <input type="text" class="form-control" formControlName="numeracion" placeholder="Número de tarjeta" />
        <div *ngIf="form.get('numeracion')?.invalid && form.get('numeracion')?.touched" class="text-danger">
          La numeración es obligatoria.
        </div>
      </div>

      <!-- Fecha de Expiración -->
      <div class="mb-3">
        <label class="form-label">Fecha de Expiración</label>
        <input type="text" class="form-control" formControlName="fechaExpiracion" placeholder="MM/AA" />
        <div *ngIf="form.get('fechaExpiracion')?.invalid && form.get('fechaExpiracion')?.touched" class="text-danger">
          La fecha de expiración es obligatoria.
        </div>
      </div>

      <!-- Nombre del Titular -->
      <div class="mb-3">
        <label class="form-label">Nombre del Titular</label>
        <input type="text" class="form-control" formControlName="nombreTitular" placeholder="Nombre del titular" />
        <div *ngIf="form.get('nombreTitular')?.invalid && form.get('nombreTitular')?.touched" class="text-danger">
          El nombre del titular es obligatorio.
        </div>
      </div>

      <!-- Nombre de la Tarjeta -->
      <div class="mb-3">
        <label class="form-label">Nombre de la Tarjeta</label>
        <input type="text" class="form-control" formControlName="nombreTarjeta" placeholder="Ej. Tarjeta personal" />
        <div *ngIf="form.get('nombreTarjeta')?.invalid && form.get('nombreTarjeta')?.touched" class="text-danger">
          El nombre de la tarjeta es obligatorio.
        </div>
      </div>

      <!-- Descripción -->
      <div class="mb-3">
        <label class="form-label">Descripción</label>
        <textarea class="form-control" formControlName="descripcion" rows="3"
          placeholder="Descripción opcional"></textarea>
      </div>

      <!-- Red -->
      <div class="mb-3">
        <label class="form-label">Red</label>
        <select class="form-select" formControlName="redId">
          <option selected disabled value="">Seleccione una red</option>
          <option *ngFor="let red of redes" [value]="red.id">{{ red.nombre }}</option>
        </select>
        <div *ngIf="form.get('redId')?.invalid && form.get('redId')?.touched" class="text-danger">
          Seleccione una red.
        </div>
      </div>

      <!-- Tipo -->
      <div class="mb-3">
        <label class="form-label">Tipo</label>
        <select class="form-select" formControlName="tipoId">
          <option selected disabled value="">Seleccione un tipo</option>
          <option *ngFor="let tipo of tipos" [value]="tipo.id">{{ tipo.nombre }}</option>
        </select>
        <div *ngIf="form.get('tipoId')?.invalid && form.get('tipoId')?.touched" class="text-danger">
          Seleccione un tipo.
        </div>
      </div>

      <!-- Lista de Errores -->
      <div *ngIf="errors.length > 0" class="alert alert-danger">
        <ul class="mb-0">
          <li *ngFor="let error of errors">{{ error }}</li>
        </ul>
      </div>

      <!-- Botones -->
      <div class="d-flex justify-content-center gap-4 mt-4">
        <button type="button" class="btn btn-primary" (click)="goBack()">
          Regresar
        </button>
        <button type="submit" class="btn btn-secondary" [disabled]="loading">
          {{ tarjeta ? 'Actualizar' : 'Guardar' }}
        </button>
      </div>

    </form>

    <!-- Spinner -->
    <ng-template #loadingTemplate>
      <div class="spinner-container">
        <div class="spinner"></div>
        <p>Cargando datos...</p>
      </div>
    </ng-template>

  </main>

</section>